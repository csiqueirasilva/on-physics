<html>
	<head>
		<title>Framework with Kepler Parameters example</title>

		<script src="../core/PhysTrace.js"></script>
		<script src="../core/PhysElement.js"></script>
		<script src="../core/PhysFramework.js"></script>
		<script src="../core/PhysSolarSystem.js"></script>
		
		<script src="../js/jquery.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>

        <script src="../js/three.min.js"></script>
		<script src="../js/stats.min.js"></script>
		<script src="../js/OrbitControls.js"></script>

		<script src="../lib/on-daed-js/geral.js"></script>
        <script src="../lib/on-daed-js/vsop87.min.js"></script>
        <script src="../lib/on-daed-js/astro.js"></script>
 
        <script src="../lib/on-daed-js/ThreeHelper.js"></script>
        <script src="../lib/on-daed-js/MathHelper.js"></script>
        <script src="../lib/on-daed-js/3D.js"></script>
		
        <link href="../css/bootstrap.min.css" rel="stylesheet"/>
        <link href="../css/bootstrap-responsive.css" rel="stylesheet"/>
		
		<style>
			#info-box {
				position: absolute;
				left: 1%;
				bottom: 1%;
				width: 300px;
				height: 380px;
				background: #ffffff;
				padding: 5px;
			}
			
			#pausar-tempo:hover, #speed-icr:hover {
				cursor: pointer;
			}
			
			#pausar-tempo, #speed-icr {
				font-weight: bold;
				font-color: #0000FF;
			}
		</style>
		
	</head>
	<body>
	
		<div id="info-box">
			<div id="pausar-tempo">Restart time</div>
			<div id="speed-icr">0.005</div>
		
			<div id="info-distancia"></div>
			<div id="info-tempo"></div>
			<div id="posicao-sol"></div>
		</div>
	
		<script>
            
			/* 			
			
				// APOPHIS
				var apophis = physFramework.addObjectFromKepler(
					EARTH_MASS * 4.519E-15,
					0.01,
					0xFFFFFF,
					.9222788903126814,
					.1910795219761208,
					3.331290217797427,
					126.3936405969297,
					204.4571896287176,
					215.5399783483177
				);
				
				physFramework.addTracingLine(apophis, 350);
			
			*/
			
			var solarSystemFramework = new PhysSolarSystem('../imgs/particleTexture.png');
			var physFramework = solarSystemFramework.physFramework;
			var EARTH_MASS = solarSystemFramework.getEarthMass();
			
			// APOPHIS
			solarSystemFramework.viewObject(
				2454441.5,
				EARTH_MASS * 4.519E-15,
				0.01,
				0xFFFFFF,
				.9222788903126814,
				.1910795219761208,
				3.331290217797427,
				126.3936405969297,
				204.4571896287176,
				215.5399783483177
			);
			
			window.onload = function () {
			
				var minDistance = Infinity;
				var maxDistance = -Infinity;
				var lastDist = 0;
				var lastLastDist = 0;
				var closestDist = Infinity;
				var closestDate = null;

				function formatNumber(n) {
					return n.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
				}
				
				window.setInterval(function() {
					
					var earth = solarSystemFramework.getEarth();
					var sun = solarSystemFramework.getSun();
					
					var dist = (earth.position.clone().sub(sun.position).length() * 149597870);
					var bodiesDist = solarSystemFramework.getEarthObjectDistance();
					
					var stringDate = ON_DAED.ASTRO.getDateFromJulian((solarSystemFramework._epochDate + physFramework._accTime)).toISOString();
					
					if(bodiesDist <= closestDist) {
						closestDist = bodiesDist;
						closestDate = stringDate;
					}
					
					if(lastLastDist <= lastDist && lastDist >= dist) {
						maxDistance = lastDist;
					} else if (lastLastDist >= lastDist && lastDist <= dist) {
						minDistance = lastDist;
					}
					
					lastLastDist = lastDist;
					lastDist = dist;
					
					var aphelion = physFramework._accTime < 365.25 ? "TBD AFTER 1 YR" : formatNumber(maxDistance);
					var perihelion = physFramework._accTime < 365.25 ? "TBD AFTER 1 YR" : formatNumber(minDistance);
					
					var e = document.getElementById('info-distancia');
					e.innerHTML = "<b>earth data</b><br />d(sun) = " + formatNumber(dist) + " km"
					+ "<br />d(apophis) = " + formatNumber(bodiesDist) + " km<br />Closest distance: " + formatNumber(closestDist) + " km<br/>on " + closestDate + "<br /><b>current orbit</b>" + "<br />aphelion = " + aphelion + "<br />perihelion = " + perihelion;
					
					e = document.getElementById('posicao-sol');
					e.innerHTML = "<b>sun position</b><br /> x: " +
						sun.physElement._position.x.toFixed(15) + "<br />y: " + 
						sun.physElement._position.y.toFixed(15) + "<br />z: " + 
						sun.physElement._position.z.toFixed(15);
						
					e = document.getElementById('info-tempo');
					e.innerHTML = "t = " + physFramework._accTime.toFixed(2) + " dias / " + (physFramework._accTime / 365.25).toFixed(2) + " anos" + "<br />" + stringDate;
					
				}, 20);
				
				document.getElementById('pausar-tempo').onclick = function(ev) {
					if(this.innerHTML === "Stop time") {
						physFramework.timeInterval = 0;
						this.innerHTML = "Restart time";
					} else {
						physFramework.timeInterval = parseFloat(document.getElementById('speed-icr').innerHTML);
						this.innerHTML = "Stop time";
					}
				}
				
				var smallerTimeStep = document.getElementById('speed-icr').innerHTML;
				var longerTimeStep = "0.05";
				
				document.getElementById('speed-icr').onclick = function(ev) {
					if(this.innerHTML === smallerTimeStep) {
						this.innerHTML = longerTimeStep;
					} else {
						this.innerHTML = smallerTimeStep;
					}
				}
				
				window.setTimeout(function() {
					StartTracingLines(100);
				}, 500);
			
			};
			
		</script>
	</body>
</html>